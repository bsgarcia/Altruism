<head>
    <link href="_static/css/slider.css" rel="stylesheet">
    <link href="_static/css/main.css" rel="stylesheet">
    <link href="_static/css/chat.css" rel="stylesheet">
    <link href="https://res.cloudinary.com/finnhvman/raw/upload/matter/matter-0.2.2.min.css" rel="stylesheet">
    <title>Online experiment</title>

    <style>
        body {
            font-family: "Open Sans", sans-serif;
            font-size: 20px;
        }

        #slider-div {
            width: 80% !important;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.3/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="_static/js/tween.umd.js"> </script>
    <script src="_static/js/slider.js"> </script>
    <script src="_static/js/rough.js"> </script>
    <script src="_static/js/main.js"> </script>
    <script src="_static/js/chat.js"> </script>
    <!-- import jquery -->
</head>

<body>
    <div style="width: 50%; margin-left: auto; margin-right:auto">
        <!--- Timeline of the experiment ---------------------->
        <div class="md-stepper-horizontal black" id="timeline">
            <div class="md-step" id="instructions">
                <div class="md-step-circle"></div>
                <div class="md-step-title">Instructions</div>
                <div class="md-step-bar-left"></div>
                <div class="md-step-bar-right"></div>
            </div>
            <div class="md-step" id="training">
                <div class="md-step-circle"></div>
                <div class="md-step-title">Training</div>
                <div class="md-step-bar-left"></div>
                <div class="md-step-bar-right"></div>
            </div>
            <div class="md-step active" id="experiment">
                <div class="md-step-circle"></div>
                <div class="md-step-title">Experiment</div>
                <div class="md-step-bar-left"></div>
                <div class="md-step-bar-right"></div>
            </div>
            <div class="md-step" id="questionnaire">
                <div class="md-step-circle"></div>
                <div class="md-step-title">Survey</div>
                <div class="md-step-bar-left"></div>
                <div class="md-step-bar-right"></div>
            </div>
        </div>
        <br>
        <!-------------------------------------------------->
        <div class="container fade-in" id="main">
            <div class="row">
                <div class="col1">

                <h2>Choose a charity</h2>
                    <section class="cards">
                        <article class="card card--1">
                            <div class="card__info-hover">
                                <svg class="card__like" viewBox="0 0 24 24">
                            </div>
                            <div class="card__img"></div>
                            <a href="#" class="card_link">
                                <div class="card__img--hover"></div>
                            </a>
                            <div class="card__info">
                                <span class="card__category">Environmental Charity</span>
                                <h3 class="card__title">World Wide Fund for Nature Inc. (WWF)</h3>
                                <!-- <span class="card__by">by <a href="#" class="card__author" title="author">Celeste -->
                                <!-- Mills</a></span> -->
                            </div>
                        </article>
                        <article class="card card--2">
                            <div class="card__info-hover">
                            </div>
                            <div class="card__img"></div>
                            <a href="#" class="card_link">
                                <div class="card__img--hover"></div>
                            </a>
                            <div class="card__info">
                                <span class="card__category">Humanitarian Charity</span>
                                <h3 class="card__title">United Nations Children's Fund</h3>
                                <!-- <span class="card__by">by <a href="#" class="card__author" title="author">John -->
                                <!-- Doe</a></span> -->
                            </div>
                        </article>
                    </section>
                    <br>
                    <br>
                    <h2>Choose an amount to give</h2>
                    <div id="slider-div">
                    </div>
                    <div align="center">
                        <button type="button" id="ok" class="matter-button-contained">CONTRIBUTE</button>
                    </div>
                </div>
                <div class="col2">
                    <div class="chat">
                        <div class="chat-title">
                            <h1>Other player</h1>
                            <!-- <h2>Supah</h2> -->
                            <figure class="avatar">
                                <img src="https://emojis.wiki/emoji-pics/messenger/bust-in-silhouette-messenger.png" />
                            </figure>
                        </div>
                        <div class="messages">
                            <div class="messages-content"></div>
                        </div>
                        <div class="message-box">
                            <div id='suggestion-charity' class="suggestion">I want to give to WWF</div>
                            <div id='suggestion-amount' class="suggestion">I want to give X euros</div>
                            <div id='suggestion-ok' class="suggestion">Ok!</div>
                            <div id='suggestion-no' class="suggestion">No!</div>
                            <textarea type="text" class="message-input" placeholder="select message..." disabled></textarea>
                            <button id="send" type="submit" class="message-submit matter-button-contained">Send</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    </div>
</body>

<script>
    let loopSend;

    // wait for the DOM and additional scripts to be loaded
    document.addEventListener('DOMContentLoaded', main);

    function main() {
            
        document.querySelector('.card--1').addEventListener('click', function (el) {
            console.log('clicked 1');
            document.querySelector('.card--2').classList.remove('selected');
            this.classList.add('selected');
            document.querySelector('#suggestion-charity').innerHTML = 'I want to give to WWF';
        });

        document.querySelector('.card--2').addEventListener('click', function (el) {
            console.log('clicked 2');
            console.log(el)
            document.querySelector('.card--1').classList.remove('selected');
            this.classList.add('selected');
            document.querySelector('#suggestion-charity').innerHTML = 'I want to give to UNICEF';
        });
            
        document.querySelectorAll('.suggestion').forEach(function (el) {
            el.addEventListener('click', function (el) {
                console.log('clicked suggestion');
                console.log(el)
                document.querySelector('.message-input').value = el.target.innerHTML;
            });
        });

        document.querySelector('#send').addEventListener('click', ()=>insertMessage())

        // if ({{ training }}) {
        // setActiveCurrentStep('training');
        // }

        let startTime = Date.now();
        let RT;
        let contribution;
        // let templateWait = `{{ html }}`;

        // params
        let min = 0;
        // let max = {{ endowment }};
        let max = 8;
        let step = 1;
        //let question = 'What was the average value of this symbol?'
        let initValue = Math.floor(Math.random() * (8 - 2 + 1)) + 2;
        // generate html
        let sliderHTML = SliderManager.generateSlider({
            text: '',
            min: min, max: max, step: step, initValue: initValue
        });
        let elSlider = document.createElement('div');
        elSlider.innerHTML = sliderHTML;

        appendElement('slider-div', elSlider);

        // replace suggestion amount by slider value
        document.getElementById('suggestion-amount').innerText = 'I want to give ' + SliderManager.getValue().toString() + ' euros';

        // listen on events
        SliderManager.listenOnSlider({}, function (event) {
            let value = event.data.slider.value;
            //choice(value, startTime);
        }, function (event) {
            let el = document.getElementById('suggestion-amount');
            // Replace any digit by value of the slider
            el.innerText = el.innerText.replace(/\d/g, SliderManager.getValue());
            console.log(value)
            //choice(value, startTime);
        });

        // allows to change value using left and right arrows
        SliderManager.listenOnArrowKeys();


        function choice(value, startTime) {

            RT = Date.now() - startTime;
            var startTime = Date.now();
            contribution = value;

            liveSend(
                {
                    time: Date.now() - startTime,
                    RT: RT,
                    contribution: contribution
                }
            );

            // setTimeout(() => {
            // $('#main').append(templateWait);
            // $("#modalWait").modal({
            // backdrop: 'static',
            // keyboard: false
            // });
            // $('#modalWait').modal('show');
            // }, 1000);

            // setInterval(() => {
            //     var wait = document.getElementById("wait");

            //     if (wait.innerHTML.length >= 3)
            //         wait.innerHTML = "";
            //     else
            //         wait.innerHTML += ".";

            // }, 1000);

            // loopSend = setInterval(() => {
            //     liveSend(
            //         {
            //             time: Date.now() - startTime,
            //             RT: RT,
            //             contribution: contribution
            //         });
            // }, 1000);
            // }

        }

        function liveRecv(data) {

            if (data === true) {
                clearInterval(loopSend);
                $('#main').fadeOut(140);
                $('#form').submit();
            }
        }
    }

</script>